name: tinyos
display-name: tinyos
revision: 1
architecture: amd64
series: jammy
class: preinstalled
kernel: linux-image-generic
gadget:
  url: file://./pc-gadget/
  type: directory
rootfs:
  components:
    - main
    - universe
    - restricted
  pocket: updates
  seed:
    urls:
      - git://git.launchpad.net/~ubuntu-core-dev/ubuntu-seeds/+git/
    branch: jammy
    names:
      - server
      - server-minimal
  sources-list-deb822: true
customization:
  components:
    - main
    - universe
    - restricted
  pocket: updates
  manual:
    make-dirs:
      - path: /opt/tinybox/screen/
        permissions: 0755
      - path: /opt/tinybox/setup/
        permissions: 0755
      - path: /opt/tinybox/monitoring/
        permissions: 0755
      - path: /raid/
        permissions: 0777
    copy-file:
      - source: ./tinybox.cfg
        destination: /etc/cloud/cloud.cfg.d/tinybox.cfg
      - source: ./misc/grub
        destination: /etc/default/grub
      - source: ./tinyturing/display.py
        destination: /opt/tinybox/screen/display.py
      - source: ./tinyturing/logo.png
        destination: /opt/tinybox/screen/logo.png
      - source: ./setup/bootup.py
        destination: /opt/tinybox/setup/bootup.py
      - source: ./setup/tinybox-bootup.service
        destination: /etc/systemd/system/tinybox-bootup.service
      - source: ./setup/firstboot.py
        destination: /opt/tinybox/setup/firstboot.py
      - source: ./setup/raidsetup.sh
        destination: /opt/tinybox/setup/raidsetup.sh
      - source: ./setup/driverinstall.sh
        destination: /opt/tinybox/setup/driverinstall.sh
      - source: ./setup/rebooting.py
        destination: /opt/tinybox/setup/rebooting.py
      - source: ./setup/firstsetup.py
        destination: /opt/tinybox/setup/firstsetup.py
      - source: ./setup/firstsetup.service
        destination: /etc/systemd/system/firstsetup.service
      - source: ./setup/correctperms.sh
        destination: /opt/tinybox/setup/correctperms.sh
      - source: ./monitoring/monitoring.py
        destination: /opt/tinybox/monitoring/monitoring.py
      - source: ./tools/fan-control
        destination: /usr/bin/fan-control
  cloud-init:
    meta-data: |
      #cloud-config
  extra-packages:
    - name: grub-efi-amd64
    - name: ipmitool
    - name: python3
    - name: python3-pip
    - name: python3-numpy
    - name: python3-serial
    - name: python3-pygame
    - name: build-essential
  extra-snaps:
    - name: core
    - name: core20
artifacts:
  img:
    - name: tinyos.img
